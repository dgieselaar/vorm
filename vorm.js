"use strict";!function(){angular.module("vorm",[])}();!function(){angular.module("vorm").factory("VormEvent",["$document","$window",function(t,n){var e=void 0;try{{new n.CustomEvent("foo")}e=function(t,e){return new n.CustomEvent(t,{detail:e,bubbles:!0})}}catch(o){e=function(n,e){var o=t[0].createEvent("CustomEvent");return o.initCustomEvent(n,!0,!0,e),o}}return e}])}();!function(){angular.module("vorm").factory("VormFieldCtrl",["VormEvent","VormValueType",function(e,n){return function(t,i){function r(e,n){var t=e.$viewChangeListeners,i=e.$modelValue;e.$viewChangeListeners=[],e.$modelValue=n,e.$$writeModelToScope(),e.listeners=t,e.$modelValue=i}function u(){o.triggerViewChange()}function a(){o.triggerModelChange()}var o={},c=[],l=[],s=[],d="vorm-field-",f=n.SINGLE,v=void 0;o.triggerModelChange=function(){i.dispatchEvent(new e("modelchange",{name:t})),_.invoke(s,"call",null,t)},o.triggerViewChange=function(){i.dispatchEvent(new e("viewchange",{name:t})),_.invoke(l,"call",null,t)},o.getName=function(){return t},o.setName=function(){t=arguments[0]},o.addModel=function(e){c.push(e),e.$viewChangeListeners.push(u),e.$formatters.push(a)},o.removeModel=function(e){_.pull(c,e),_.pull(e.$viewChangeListeners,u),_.pull(e.$formatters,a)},o.getModels=function(){return c},o.getValue=function(){var e=void 0;switch(f){case n.SINGLE:e=c[0]?c[0].$modelValue:void 0;break;case n.LIST:e=_.pluck(c,"$modelValue");break;case n.NAMED:e={},_.each(c,function(n){e[n.$name]=n.$modelValue})}return e},o.getValueType=function(){return f},o.setValueType=function(e){if(-1===[n.SINGLE,n.LIST,n.NAMED].indexOf(e))throw new Error("Unsupported VormValueType: "+n);f=e},o.setValue=function(e){switch(f){case n.SINGLE:c[0]&&r(c[0],e);break;case n.LIST:_.each(c,function(n,t){r(n,e[t])});break;case n.NAMED:var t=c.concat();_.each(e,function(e,n){var i=_.find(c,{$name:n});i&&r(i,e),_.pull(t,i)}),_.each(t,function(e){r(e,void 0)})}},o.isRequired=function(){return v},o.setRequired=function(){v=!!arguments[0]},o.isEmpty=function(){return c.every(function(e){return e.$isEmpty()})};var h=_("valid invalid dirty pristine touched untouched required empty".split(" ")).map(function(e){return d+e}).zipObject().mapValues(function(e,n){var t=n.substr(d.length);return o["is"+_.capitalize(t)]()}).each(function(){});return o.getClassObj=function(){return h.value()},o.viewChangeListeners=l,o.modelChangeListeners=s,"valid invalid dirty pristine touched untouched".split(" ").forEach(function(e){var n=_.capitalize(e),t="is"+n,i="$"+e,r="set"+n,u=-1!==["valid","pristine","untouched"].indexOf(e)?"every":"some";o[t]=function(){return c[u](function(e){return e[i]})},"valid"!==e&&"invalid"!==e&&(o[r]=function(){var e=arguments;c.forEach(function(n){n["$"+r].apply(n,e)})})}),o}}])}();!function(){angular.module("vorm").factory("VormModelCtrl",[function(){return function(){var n=this,t=void 0,e=void 0,r={viewChangeListeners:[],validators:[],asyncValidators:[],formatters:[],parsers:[]};return _.each(r,function(t,r){n[r]={add:function(n){t.push(n),e&&e["$"+r].push(n)},remove:function(n){_.pull(t,n),e&&_.pull(e["$"+r],n)},get:function(){return t}}}),n.setName=function(n){t=n},n.getName=function(){return t},n.setNgModel=function(n){if(n)throw new Error("vorm/model-set");return e=n,_.each(r,function(n,t){Array.prototype.push.apply(e["$"+t],n)}),function(){e=null}},"pending untouched touched pristine dirty valid invalid".split(" ").forEach(function(t){var r="is"+_.capitalize(t),i="$"+t;n[r]=function(){return e?e[i]:void 0}}),n.setViewValue=function(n){e.$setViewValue(n),e.$render()},n.value=null,n}}])}();!function(){angular.module("vorm").directive("VormModelDelegate",["VormModelDelegateCtrl",function(e){return{controller:["$scope","$attrs",function(t,o){var l=this,r=t.$eval(o.delegate);r||(r=new e),l.setNgModel=r.setNgModel}]}}])}();!function(){angular.module("vorm").factory("VormModelDelegateCtrl",[function(){return function(){var e={},n=void 0,t=null,r=[];return e.value=void 0,e.setName=function(){return n},e.getName=function(){return n},e.setNgModel=function(n){if(t)throw new Error("Cannot set ngModel twice");return t=n,Array.prototype.push.apply(t.$viewChangeListeners,r),e.viewChangeListeners=t.$viewChangeListeners,function(){t=null}},e.getNgModel=function(){return t},e.clearViewValue=function(){t.$setViewValue(void 0),t.$render()},e.viewChangeListeners=r,e}}])}();!function(){angular.module("vorm").constant("VormValueType",{SINGLE:"single",LIST:"list",NAMED:"named"})}();var _slicedToArray=function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r)){var t=[],n=!0,o=!1,i=void 0;try{for(var a,l=r[Symbol.iterator]();!(n=(a=l.next()).done)&&(t.push(a.value),!e||t.length!==e);n=!0);}catch(u){o=!0,i=u}finally{try{!n&&l["return"]&&l["return"]()}finally{if(o)throw i}}return t}throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){angular.module("vorm").directive("ngModel",[function(){return{require:["ngModel","^?vormModel"],link:function(r,e,t,n){var o=_slicedToArray(n,2),i=o[0],a=o[1];if(a){var l=a.setNgModel(i);r.$on("$destroy",function(){l()})}}}}])}();!function(){angular.module("vorm").directive("vormChange",["$parse",function(n){return{link:function(e,a,i){function r(n,a){t(e,{$event:n,$name:n.detail?n.detail.name:a})}var t=n(i.vormChange);a.bind("viewchange",r)}}}])}();!function(){angular.module("vorm").directive("vormControl",["$document",function(e){var t=function(){var t=e[0].createElement("div");return _(["","ms","moz","webkit"]).map(function(e){return e?e+"MatchesSelector":"matches"}).find(function(e){return e in t})}();return{restrict:"E",require:["vormControl","^vormField","^vormFieldConfig","^vormFocusableList","^vormFieldTemplate"],controller:["$scope","$element","$attrs",function(e,n,o){var r,i,a,u,l=this,c=Math.random().toString(36).slice(2);l.link=function(d){r=d[0],i=d[1],a=d[2],u=d[3],l.invokeData=i.invokeData,l.getData=i.getData,l.getConfig=i.getConfig,a.addId(c),u.getModelCompiler()(e,function(r){var i=void 0,a="input,keygen,meter,output,progress,select,textarea";n.prepend(r),i=r[0][t](a)?r:angular.element(r[0].querySelector(a)),i.attr("id",l.getInputId()),e.$$postDigest(function(){e.$eval(o.delegate).setNgModel(r.controller("ngModel"))})})},l.isRequired=function(){return r&&r.isRequired()},l.getInputId=function(){return c},l.getOptions=angular.version.minor>=4?function(){return u.invokeData("options")}:function(){var e=void 0;return function(){var t=i.invokeData("options");return e===t||angular.equals(e,t)||(e=t),e}}(),e.$on("$destroy",function(){a.removeId(c)})}],controllerAs:"vormControl",link:function(e,t,n,o){o[0].link(o.slice(1))}}}])}();!function(){angular.module("vorm").directive("vormControlList",["vormTemplateService","VormModelDelegate",function(e,t){return{require:["vormControlList","^vormFieldConfig","^vormField"],restrict:"E",template:e.getDefaultControlTemplate(),controller:["$scope",function(e){function n(){var t=e.$watchCollection(c.getModels,function(){c.triggerViewChange(),t()})}var i=this,o=[],l=0/0,r=void 0,c=void 0;i.link=function(e){var t=void 0;r=e[0],c=e[1],t=r.getConfig().valueType,t&&void 0!==t.limit&&(l=t.limit)},i.getDelegates=function(){return o},i.createDelegate=function(e){var n=void 0;e||(e=o.length.toString()),n=new t(e),o.push(n)},i.removeDelegate=function(e){_.pull(o,e)},i.clearDelegate=function(e){e.clearViewValue()},i.getLimit=function(){return l},i.setLimit=function(e){l=Number(e)},i.reachedLimit=function(){return l>0&&o.length>l},i.isClearButtonVisible=function(){return o.length>1},i.handleCreateClick=function(){i.createDelegate(),n()},i.handleClearClick=function(e){1===o.length?e.clearViewValue():(i.removeDelegate(e),n())}}],controllerAs:"vormControlList",link:function(e,t,n,i){i[0].link(i.slice(1))}}}])}();!function(){angular.module("vorm").directive("vormDelegateButton",[function(){return{require:["vormDelegateButton","^vormFieldConfig","^vormControlList","^vormField"],template:'<button class="vorm-delegate-button" type="button" ng-click="vormDelegateButton.handleClick()" ng-disabled="vormDelegateButton.isDisabled()" ng-show="vormDelegateButton.isVisible()">{{vormDelegateButton.getLabel()}}</button>',replace:!0,controller:[function(){var e=this,t=void 0,n=void 0,o=void 0;e.link=function(e){t=e[0],n=e[1],o=e[2]},e.handleClick=function(){n.handleCreateClick()},e.isDisabled=function(){return n?n.reachedLimit():!0},e.isVisible=function(){return o?"list"===o.getValueType():!1},e.getLabel=function(){var e=t.getConfig(),n=e?e.valueType:null,o=n&&n.addLabel?t.invoke(n.addLabel):"";return o}}],link:function(e,t,n,o){o[0].link(o.slice(1))},controllerAs:"vormDelegateButton"}}])}();var _slicedToArray=function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r)){var t=[],n=!0,o=!1,i=void 0;try{for(var l,a=r[Symbol.iterator]();!(n=(l=a.next()).done)&&(t.push(l.value),!e||t.length!==e);n=!0);}catch(d){o=!0,i=d}finally{try{!n&&a["return"]&&a["return"]()}finally{if(o)throw i}}return t}throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){angular.module("vorm").directive("vormField",["VormFieldCtrl",function(r){return{scope:!0,require:["vormField","^?vormForm"],controller:["$scope","$element","$attrs",function(e,t,n){var o=e.$eval(n.vormField)||n.ngModel,i=this;angular.extend(i,new r(o,t[0]))}],controllerAs:"vormField",link:function(r,e,t,n){var o=_slicedToArray(n,2),i=o[0],l=o[1];l&&(l.addField(i),r.$on("$destroy",function(){l.removeField(i)}))}}}])}();!function(){angular.module("vorm").directive("vormFieldConfig",["vormInvoke",function(e){return{require:["vormFieldConfig","vormField","^?vormForm"],controller:["$scope","$attrs",function(i,t){var n=this,r=i.$eval(t.vormFieldConfig),o=void 0,u=void 0;n.link=function(e){o=e[0],u=e[1],o.setName(r.name),void 0!==r.valueType&&("string"==typeof r.valueType?o.setValueType(r.valueType):void 0!==r.valueType.type&&o.setValueType(r.valueType.type)),_.isArray(r.required)||"function"==typeof r.required?i.$watch(n.invoke.bind(r.required),function(e){o.setRequired(!!e)}):o.setRequired(r.required||!1)},n.invoke=function(i){var t=void 0;return u?t=u.getValues():o&&(t={},t[o.getName()]=o.getValue()),e(i,{$values:t})},n.getConfig=function(){return r},n.getData=function(){return r.data},n.invokeData=function(e){return n.invoke(r.data[e])},n.getLimit=function(){var e=1;return"list"===o.getValueType()&&(e=-1,r.valueType&&void 0!==r.valueType.limit&&(e=n.invoke(r.valueType.limit))),e}}],link:function(e,i,t,n){n[0].link(n.slice(1))}}}])}();!function(){angular.module("vorm").directive("vormFieldTemplate",["vormTemplateService",function(e){var t=angular.element(e.getDefaultTemplate());angular.element(t[0].querySelectorAll("vorm-replace")).replaceWith(angular.element("<vorm-control-list></vorm-control-list>")),t.attr("vorm-field-config","vormFieldTemplate.getConfig()"),t.attr("vorm-focusable-list","");var r=t[0].outerHTML;return{scope:!0,restrict:"E",template:r,replace:!0,controller:["$scope","$attrs",function(t,r){var l=this,a=t.$eval(r.config)||{},o=void 0;if(a=_.defaults(angular.copy(a),{name:r.name,type:r.type,label:r.label,template:t.$eval(r.template),required:t.$eval(r.required),data:t.$eval(r.data)||{}}),!a.name||!a.type)throw new Error("Missing one of required arguments: name, type ");o=e.getModelCompiler(a.type,a.modelTemplate),l.getConfig=function(){return a},l.getModelCompiler=function(){return o}}],controllerAs:"vormFieldTemplate",link:function(){}}}])}();!function(){angular.module("vorm").directive("vormFieldWrapper",["vormTemplateService",function(e){var r=angular.element(e.getDefaultTemplate());r.find("vorm-replace").append("<ng-transclude></ng-transclude>");var t=r[0].outerHTML;return{restrict:"A",transclude:!0,template:t,replace:!0,controller:["$attrs",function(e){var r=this;r.getLabel=function(){return e.label}}]}}])}();!function(){angular.module("vorm").directive("vormFieldset",[function(){return{restrict:"E",template:'\n					<fieldset>\n						<vorm-field-template config="field" ng-repeat="field in vormFieldset.getFields()">\n						</vorm-field-template>\n					</fieldset>\n				',scope:{fields:"&"},replace:!0,controller:["$scope",function(e){var t=this;t.getFields=e.fields}],controllerAs:"vormFieldset"}}])}();!function(){angular.module("vorm").directive("vormFocusableList",[function(){return{controller:[function(){var n=this,t=[];n.addId=function(n){t.push(n)},n.removeId=function(n){_.pull(t,n)},n.getId=function(){return t[t.length-1]}}]}}])}();!function(){angular.module("vorm").directive("vormForm",[function(){return{scope:!0,require:["form"],controller:["$element",function(e){function n(){l=_(u).indexBy(function(e){return e.getName()}).mapValues(function(e){return e.getValue()}).value(),Object.freeze(l)}function t(){var e=arguments;n(),_.each(o,function(n){n.apply(r,e)})}function i(){n()}var r=this,u=[],o=[],s=[],l={};return r.addField=function(e){u.push(e),e.viewChangeListeners.push(t),e.modelChangeListeners.push(i),n()},r.removeField=function(e){_.pull(u,e),_.pull(e.viewChangeListeners,t),_.pull(e.modelChangeListeners,i),n()},r.getFields=function(){return u},r.getValues=function(){return l},r.changeListeners=o,r.submitListeners=s,"valid invalid dirty pristine touched untouched".split(" ").forEach(function(e){var n=e.substr(0,1).toUpperCase()+e.substr(1),t="is"+n,i="set"+n,o=-1!==["valid","pristine","untouched"].indexOf(e)?"every":"some";r[t]=function(){return u[o](function(e){return e[t]()})},"valid"!==e&&"invalid"!==e&&(r[i]=function(){var e=arguments;u.forEach(function(n){n[i].apply(n,e)})})}),e.bind("submit",function(){_.invoke(s,"call",null,l)}),r}],controllerAs:"vormForm"}}])}();!function(){angular.module("vorm").factory("vormInvoke",["$injector",function(n){return function(o,r){var t;return o?t=_.isArray(o)&&"function"==typeof _.last(o)||void 0!==o.$inject?n.invoke(o,null,angular.copy(r)):"function"==typeof o?o():o:o}}])}();!function(){angular.module("vorm").directive("vormLabel",[function(){return{require:["vormLabel","^vormFieldConfig","^vormFocusableList"],template:'<label class="vorm-field-label">{{vormLabel.getLabel()}}</label>',replace:!0,controller:["$scope","$element",function(e,l){var o=this,n=void 0,r=void 0;o.link=function(o){n=o[0],r=o[1],e.$watch(r.getId,function(e){l.attr("for",e)})},o.getLabel=function(){return n.invoke(n.getConfig().label)}}],controllerAs:"vormLabel",link:function(e,l,o,n){n[0].link(n.slice(1))}}}])}();var _slicedToArray=function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r)){var e=[],n=!0,i=!1,o=void 0;try{for(var a,u=r[Symbol.iterator]();!(n=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);n=!0);}catch(l){i=!0,o=l}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return e}throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){angular.module("vorm").directive("vormSubmit",["$parse",function(r){return{require:["vormForm"],link:function(t,e,n,i){function o(){l(t,{$values:u.getValues()})}var a=_slicedToArray(i,1),u=a[0],l=void 0;l=r(n.vormSubmit),e.bind("submit",o)}}}])}();!function(){angular.module("vorm").provider("vormTemplateService",[function(){function e(e){a=_.mapValues(a,function(t,o){return e(t,o)})}function t(e){var t=e(angular.element(r));t.attr("vorm-field",""),t.find("vorm-control").attr("limit","vormFieldConfig.getLimit()"),r=t[0].outerHTML}function o(e){n=e(angular.element(n))[0].outerHTML}var r=void 0,n=void 0,l=void 0,a={},i={};return r='<div ng-class="vormField.getClassObj()"><vorm-label></vorm-label><vorm-replace></vorm-replace></div>',n='<vorm-control ng-repeat="delegate in vormControlList.getDelegates()"><vorm-control-replace></vorm-control-replace><button class="vorm-control-clear-button" type="button" ng-click="vormControlList.handleClearClick(delegate)" ng-show="vormControlList.isClearButtonVisible()">x</button></vorm-control><vorm-delegate-button></vorm-delegate-button>',a=_(a).assign(_("date datetime datetime-local email month number password search tel text time url week checkbox".split(" ")).zipObject().mapValues(function(e,t){var o=_.includes("text search tel url email number password".split(" "),t)?"placeholder=\"{{vormControl.invokeData('placeholder')}}\"":"";return'<input type="'+t+'" '+o+"/>"}).value()).value(),a.select='<select ng-options="option.value as option.label for option in vormControl.getOptions()"><option value="" data-ng-show="vormControl.invokeData(\'notSelectedLabel\')">{{vormControl.invokeData(\'notSelectedLabel\')}}</option></select>',a=_.mapValues(a,function(e){return angular.element(e)}),t(function(){return angular.element(r)}),o(function(){return angular.element(n)}),{$get:["$compile",function(e){return i.getDefaultTemplate=function(){return r},i.getDefaultControlTemplate=function(){return n},i.getModelCompiler=function(t,o){var r=void 0;if(r=o?e(o):l[t],!r)throw new Error("Model template for "+t+" not found");return r},l=_.mapValues(a,function(t){var o=void 0;return _.some(t,function(e){var t=void 0;return e.hasAttribute("ng-model")?o=angular.element(e):(t=e.querySelector("[ng-model]"))&&(o=angular.element(t)),!!o}),o||(o=t),o.attr("ng-model","delegate.value"),o.attr("ng-required","vormControl.isRequired()"),e(t)}),i}],modifyModelTemplates:e,modifyControlTemplate:o,modifyTemplate:t}}])}();
//# sourceMappingURL=vorm.js.map