"use strict";!function(){angular.module("vorm",[])}();!function(){angular.module("vorm").factory("VormEvent",["$document","$window",function(t,n){var e=void 0;try{{new n.CustomEvent("foo")}e=function(t,e){return new n.CustomEvent(t,{detail:e,bubbles:!0})}}catch(o){e=function(n,e){var o=t[0].createEvent("CustomEvent");return o.initCustomEvent(n,!0,!0,e),o}}return e}])}();!function(){angular.module("vorm").factory("VormFieldCtrl",["$rootScope","VormEvent","VormValueType","VormValueScope",function(e,n,t,i){return function(e,r){function u(){var e=void 0;switch(h){case t.SINGLE:e=null;break;case t.LIST:e=[null];break;case t.NAMED:e={}}return e}function a(e,n){var t=e.$viewChangeListeners,i=e.$modelValue;e.$viewChangeListeners=[],e.$modelValue=n,e.$$writeModelToScope(),e.listeners=t,e.$modelValue=i}function o(){var n=V[e];switch(h){case t.SINGLE:d[0]&&a(d[0],n);break;case t.LIST:_.each(d,function(e,t){a(e,n[t])});break;case t.NAMED:var i=d.concat();_.each(n,function(e,n){var t=_.find(d,{$name:n});t&&a(t,e),_.pull(i,t)}),_.each(i,function(e){a(e,void 0)})}}function c(){var e=void 0;switch(h){case t.SINGLE:e=d[0]?d[0].$modelValue:void 0;break;case t.LIST:e=_.pluck(d,"$modelValue");break;case t.NAMED:e={},_.each(d,function(n){e[n.$name]=n.$modelValue})}return e}function l(){V[e]=c(),f.triggerViewChange()}function s(n){var t=c();return V[e]=t,f.triggerModelChange(),n}var f={},d=[],v=[],p=[],m="vorm-field-",h=t.SINGLE,g=void 0,V=new i;f.triggerModelChange=function(){r.dispatchEvent(new n("modelchange",{name:e})),_.invoke(p,"call",null,e)},f.triggerViewChange=function(){r.dispatchEvent(new n("viewchange",{name:e})),_.invoke(v,"call",null,e)},f.getName=function(){return e},f.setName=function(){e=arguments[0]},f.addModel=function(n){d.push(n),n.$viewChangeListeners.push(l),n.$formatters.push(s),V[e]=c()},f.removeModel=function(n){_.pull(d,n),_.pull(n.$viewChangeListeners,l),_.pull(n.$formatters,s),V[e]=c()},f.getModels=function(){return d},f.getValue=function(){return V[e]},f.getValueType=function(){return h},f.setValueType=function(n){if(-1===[t.SINGLE,t.LIST,t.NAMED].indexOf(n))throw new Error("Unsupported VormValueType: "+t);h=n,V[e]=u()},f.setValue=function(n){V[e]=n,o()},f.setEmpty=function(){V[e]=u()},f.isRequired=function(){return g},f.setRequired=function(e){g=!!e},f.isEmpty=function(){return d.every(function(e){return e.$isEmpty(e.$viewValue)})},f.setValueScope=function(n){var t=V[e];V&&V.$destroy(),V=n,V[e]=t},f.getValueScope=function(){return V};var $=_("valid invalid dirty pristine touched untouched required empty".split(" ")).map(function(e){return m+e}).zipObject().mapValues(function(e,n){var t=n.substr(m.length);return f["is"+_.capitalize(t)]()});return f.getClassObj=function(){return $.value()},f.setEmpty(),f.viewChangeListeners=v,f.modelChangeListeners=p,"valid invalid dirty pristine touched untouched".split(" ").forEach(function(e){var n=_.capitalize(e),t="is"+n,i="$"+e,r="set"+n,u=-1!==["valid","pristine","untouched"].indexOf(e)?"every":"some";f[t]=function(){return d[u](function(e){return e[i]})},"valid"!==e&&"invalid"!==e&&(f[r]=function(){var e=arguments;d.forEach(function(n){n["$"+r].apply(n,e)})})}),V[e]=u(),f}}])}();!function(){angular.module("vorm").factory("VormModelDelegate",[function(){return function(e){var n={},u=null;return n.value=null,n.getName=function(){return e},n.setNgModel=function(n){u=n,u&&(u.$name=e)},n.unsetNgModel=function(){u=null},n.getNgModel=function(){return u},n.clearViewValue=function(){u.$setViewValue(null),u.$render()},n.getViewValue=function(){return u?u.$viewValue:n.value},n}}])}();!function(){angular.module("vorm").factory("VormValueScope",["$rootScope",function(o){return function(){var n=o.$new();return n}}])}();!function(){angular.module("vorm").constant("VormValueType",{SINGLE:"single",LIST:"list",NAMED:"named"})}();var _slicedToArray=function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r)){var n=[],o=!0,t=!1,i=void 0;try{for(var l,a=r[Symbol.iterator]();!(o=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);o=!0);}catch(d){t=!0,i=d}finally{try{!o&&a["return"]&&a["return"]()}finally{if(t)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){angular.module("vorm").directive("ngModel",["VormFieldCtrl",function(r){return{require:["ngModel","^?vormField","^?vormForm"],compile:function(){return function(e,n,o,t){var i=_slicedToArray(t,3),l=i[0],a=i[1],d=i[2];(a||d)&&(a||(a=new r(o.name||o.ngModel,n[0]),d&&(d.addField(a),e.$on("$destroy",function(){d.removeField(a)}))),a.addModel(l),e.$on("$destroy",function(){a.removeModel(l)}))}}}}])}();!function(){angular.module("vorm").directive("vormChange",["$parse",function(n){return{link:function(e,a,i){function r(n,a){t(e,{$event:n,$name:n.detail?n.detail.name:a})}var t=n(i.vormChange);a.bind("viewchange",r)}}}])}();!function(){angular.module("vorm").directive("vormControl",["$document",function(e){var t=function(){var t=e[0].createElement("div");return _(["","ms","moz","webkit"]).map(function(e){return e?e+"MatchesSelector":"matches"}).find(function(e){return e in t})}();return{restrict:"E",require:["vormControl","^vormField","^vormFieldConfig","^vormFocusableList","^vormFieldTemplate"],controller:["$scope","$element","$attrs",function(e,n,o){var r,i,a,u,l=this,c=Math.random().toString(36).slice(2);l.link=function(s){r=s[0],i=s[1],a=s[2],u=s[3],l.invokeData=i.invokeData,l.getData=i.getData,l.getConfig=i.getConfig,a.addId(c),u.getModelCompiler()(e,function(r){var i=void 0,a="input,keygen,meter,output,progress,select,textarea",u=n.find("vorm-control-replace"),c=e.$eval(o.delegate);u.replaceWith(r),r[0].className+=" "+u[0].className,i=r[0][t](a)?r:angular.element(r[0].querySelector(a)),i.attr("id",l.getInputId()),e.$$postDigest(function(){c.setNgModel(r.controller("ngModel"))}),e.$on("$destroy",function(){c.unsetNgModel()})})},l.isRequired=function(){return r&&r.isRequired()},l.getInputId=function(){return c},l.getViewValue=function(){return e.$eval(o.delegate).getViewValue()},l.getDisplayMode=function(){return i.getDisplayMode()},l.getOptions=angular.version.minor>=4?function(){return l.invokeData("options")}:function(){var e=void 0;return function(){var t=l.invokeData("options");return e===t||angular.equals(e,t)||(e=t),e}}(),e.$on("$destroy",function(){a.removeId(c)})}],controllerAs:"vormControl",link:function(e,t,n,o){o[0].link(o.slice(1))}}}])}();!function(){angular.module("vorm").directive("vormControlList",["VormModelDelegate","$document",function(e,t){return{require:["vormControlList","^vormFieldConfig","^?vormFocusableList","^vormField"],restrict:"E",controller:["$scope",function(n){function i(e){var t=n.$watchCollection(g.getModels,function(){g.triggerViewChange(),e(),t()})}function l(){if(s){var e=s.getId(),n=t[0].getElementById(e);n&&n.focus()}}function o(t){var n=void 0,i=void 0;switch(n=new e(t),g.getValueType()){case"list":i=g.getValue()[r.length];break;case"named":i=g.getValue()[t];break;case"single":i=g.getValue()}n.value=i,r.push(n)}var u=this,r=[],a=0/0,c=void 0,s=void 0,g=void 0;u.link=function(e){c=e[0],s=e[1],g=e[2],n.$watch(c.getLimit,function(e){u.setLimit(e)}),n.$watchCollection(function(){var e=void 0,t=g.getValue();switch(g.getValueType()){default:e=_.keys(t);break;case"single":e=null}return e},function(e){r=[],e||o(),_.each(e,function(e){o(e)})})},u.getDelegates=function(){return r},u.clearDelegate=function(e){e.clearViewValue()},u.getLimit=function(){return a},u.setLimit=function(e){a=Number(e)},u.reachedLimit=function(){return a>0&&r.length>=a},u.isClearButtonVisible=function(){return"list"===g.getValueType()},u.handleCreateClick=function(){g.setValue(g.getValue().concat(null)),i(l)},u.handleClearClick=function(e){if(1===r.length)e.clearViewValue();else{var t=g.getValue(),n=_.find(g.getModels(),{model:e.getNgModel()});t.splice(n,1),g.setValue(t),i(l)}}}],controllerAs:"vormControlList",link:function(e,t,n,i){i.shift().link(i)}}}])}();!function(){angular.module("vorm").directive("vormDelegateButton",[function(){return{require:["vormDelegateButton","^vormFieldConfig","^vormControlList","^vormField"],template:'<button class="vorm-delegate-button" type="button" ng-click="vormDelegateButton.handleClick()" ng-disabled="vormDelegateButton.isDisabled()" ng-show="vormDelegateButton.isVisible()">{{vormDelegateButton.getLabel()}}</button>',replace:!0,controller:[function(){var e=this,t=void 0,n=void 0,o=void 0;e.link=function(e){t=e[0],n=e[1],o=e[2]},e.handleClick=function(){n.handleCreateClick()},e.isDisabled=function(){return n.reachedLimit()},e.isVisible=function(){return"list"===o.getValueType()},e.getLabel=function(){var e=t.getConfig(),n=e?e.valueType:null,o=n&&n.addLabel?t.invoke(n.addLabel):"";return o}}],link:function(e,t,n,o){o.shift().link(o)},controllerAs:"vormDelegateButton"}}])}();!function(){angular.module("vorm").directive("vormDisplay",["vormTemplateService",function(e){return{restrict:"E",require:["vormDisplay","^vormControl","^vormFieldConfig"],controller:["$scope","$element",function(i,o){var l=this,t=void 0,n=void 0;l.link=function(r){var a=void 0,v=void 0,u=void 0;t=r[0],n=r[1],u=n.getConfig(),a=u.template?u.template.display:null,v=e.getDisplayCompiler(u.type,a),v(i,function(e){o.append(e)}),l.getViewValue=t.getViewValue,l.getModelValue=t.getModelValue}}],controllerAs:"vormDisplay",link:function(e,i,o,l){l.shift().link(l)}}}])}();var _slicedToArray=function(r,e){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r)){var n=[],t=!0,o=!1,i=void 0;try{for(var l,a=r[Symbol.iterator]();!(t=(l=a.next()).done)&&(n.push(l.value),!e||n.length!==e);t=!0);}catch(d){o=!0,i=d}finally{try{!t&&a["return"]&&a["return"]()}finally{if(o)throw i}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){angular.module("vorm").directive("vormField",["VormFieldCtrl",function(r){return{scope:!0,require:["vormField","^?vormForm"],controller:["$scope","$element","$attrs",function(e,n,t){var o=e.$eval(t.vormField)||t.name||t.ngModel,i=this;angular.extend(i,new r(o,n[0])),i.link=function(r){var n=_slicedToArray(r,1),t=n[0];t&&(t.addField(i),e.$on("$destroy",function(){t.removeField(i)}))}}],controllerAs:"vormField",link:function(r,e,n,t){t.shift().link(t)}}}])}();!function(){angular.module("vorm").directive("vormFieldConfig",["vormInvoke",function(e){return{require:["vormFieldConfig","vormField","^?vormForm"],controller:["$scope","$attrs",function(i,n){function t(){var e=void 0;return l?e=l.getValues():u&&(e={},e[u.getName()]=u.getValue()),e}var r=this,o=i.$eval(n.vormFieldConfig),u=void 0,l=void 0;r.link=function(e){u=e[0],l=e[1],u.setName(o.name),void 0!==o.valueType&&("string"==typeof o.valueType?u.setValueType(o.valueType):void 0!==o.valueType.type&&u.setValueType(o.valueType.type)),_.isArray(o.required)||"function"==typeof o.required?i.$watch(function(){return r.invoke(o.required)},function(e){u.setRequired(!!e)}):u.setRequired(o.required||!1),o.defaults&&u.setValue(r.invoke(o.defaults))},r.invoke=function(i){return e(i,{$values:t()})},r.invokeExpr=function(i){return e.expr(i,{$values:t()},u.getValueScope())},r.getConfig=function(){return o},r.invokeData=function(e){return r.invoke(o.data[e])},r.getLimit=function(){var e=1;return"list"===u.getValueType()&&(e=-1,o.valueType&&void 0!==o.valueType.limit&&(e=r.invoke(o.valueType.limit))),e},r.getDisplayMode=function(){return r.invokeExpr(o.disabled)?"display":"edit"}}],controllerAs:"vormFieldConfig",link:function(e,i,n,t){t.shift().link(t)}}}])}();!function(){angular.module("vorm").directive("vormFieldTemplate",["vormTemplateService",function(e){var t=angular.element(e.getDefaultTemplate());angular.element(t[0].querySelectorAll("vorm-replace")).replaceWith(e.getDefaultControlTemplate()),t.attr("vorm-field-config","vormFieldTemplate.getConfig()"),t.attr("vorm-focusable-list","");var r=t[0].outerHTML;return{scope:!0,restrict:"E",template:r,replace:!0,controller:["$scope","$attrs","$element",function(t,r,l){var a=this,o=t.$eval(r.config)||{},n=void 0;if(o=_.defaults(angular.copy(o),{name:r.name,type:r.type,label:r.label,template:t.$eval(r.template),required:t.$eval(r.required),data:t.$eval(r.data)||{}}),!o.name||!o.type)throw new Error("Missing one of required arguments: name, type ");n=e.getModelCompiler(o.type,o.modelTemplate),l.attr("vorm-field",o.name),a.getConfig=function(){return o},a.getModelCompiler=function(){return n}}],controllerAs:"vormFieldTemplate"}}])}();!function(){angular.module("vorm").directive("vormFieldWrapper",["vormTemplateService",function(e){var r=angular.element(e.getDefaultTemplate());r.find("vorm-replace").append("<ng-transclude></ng-transclude>"),r.attr("vorm-field-config","vormFieldWrapper.getConfig()"),r.attr("vorm-focusable-list","");var t=r[0].outerHTML;return{restrict:"A",transclude:!0,template:t,replace:!0,controller:["$attrs",function(e){var r=this,t={name:e.name,label:e.label};r.getConfig=function(){return t}}],controllerAs:"vormFieldWrapper"}}])}();!function(){angular.module("vorm").directive("vormFieldset",["vormInvoke",function(e){return{restrict:"E",require:["vormFieldset","^?vormForm"],template:'\n					<fieldset>\n						<vorm-field-template config="field" ng-repeat="field in vormFieldset.getFields() | filter:vormFieldset.isVisible:field">\n						</vorm-field-template>\n					</fieldset>\n				',replace:!0,controller:["$scope","$attrs",function(i,t){function n(){var e={};return r&&(e=r.getValues()),e}var l=this,r=void 0,o=void 0;l.link=function(e){r=e[0],r&&(o=r.getValueScope())},l.getFields=function(){return i.$eval(t.fields)},l.isVisible=function(i){return null===i.when||void 0===i.when?!0:!!e.expr(i.when,{$values:n()},o)}}],controllerAs:"vormFieldset",link:function(e,i,t,n){n.shift().link(n)}}}])}();!function(){angular.module("vorm").directive("vormFocusableList",[function(){return{controller:[function(){var n=this,t=[];n.addId=function(n){t.push(n)},n.removeId=function(n){_.pull(t,n)},n.getId=function(){return t[t.length-1]}}]}}])}();!function(){angular.module("vorm").directive("vormForm",["VormValueScope",function(e){return{scope:!0,require:["form"],controller:["$element",function(n){function t(){var e=arguments;_.each(o,function(n){n.apply(r,e)})}function u(e){return _.find(i,function(n){return n.getName()===e})}var r=this,i=[],o=[],a=[],l=new e;return r.addField=function(e){i.push(e),e.viewChangeListeners.push(t),e.setValueScope(l)},r.removeField=function(e){_.pull(i,e),_.pull(e.viewChangeListeners,t)},r.getFields=function(){return i},r.getValues=function(){var e=_(i).indexBy(function(e){return e.getName()}).mapValues(function(e){return e.getValue()}).value();return e},r.getValue=function(e){return u(e).getValue()},r.setValue=function(e,n){u(e).setValue(n)},r.getValueScope=function(){return l},r.changeListeners=o,r.submitListeners=a,"valid invalid dirty pristine touched untouched".split(" ").forEach(function(e){var n=e.substr(0,1).toUpperCase()+e.substr(1),t="is"+n,u="set"+n,o=-1!==["valid","pristine","untouched"].indexOf(e)?"every":"some";r[t]=function(){return i[o](function(e){return e[t]()})},"valid"!==e&&"invalid"!==e&&(r[u]=function(){var e=arguments;i.forEach(function(n){n[u].apply(n,e)})})}),n.bind("submit",function(){_.invoke(a,"call",null,r.getValues())}),r}],controllerAs:"vormForm"}}])}();!function(){angular.module("vorm").factory("vormInvoke",["$injector","$parse",function(n,r){function o(r,o){var t=void 0;return r?t=_.isArray(r)&&"function"==typeof _.last(r)||void 0!==r.$inject?n.invoke(r,null,o?angular.copy(o):null):"function"==typeof r?r():r:r}var t=function(n,r){return o(n,r)};return t.expr=function(n,t,u){var i=void 0;return i="string"==typeof n?r(n)(u,t):o(n,t)},t}])}();!function(){angular.module("vorm").directive("vormLabel",[function(){return{require:["vormLabel","^vormFieldConfig","^vormFocusableList"],template:'<label class="vorm-field-label">{{vormLabel.getLabel()}}</label>',replace:!0,controller:["$scope","$element",function(e,l){var o=this,n=void 0,r=void 0;o.link=function(o){n=o[0],r=o[1],e.$watch(r.getId,function(e){l.attr("for",e)})},o.getLabel=function(){return n.invoke(n.getConfig().label)}}],controllerAs:"vormLabel",link:function(e,l,o,n){n[0].link(n.slice(1))}}}])}();var _slicedToArray=function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r)){var e=[],n=!0,i=!1,o=void 0;try{for(var a,u=r[Symbol.iterator]();!(n=(a=u.next()).done)&&(e.push(a.value),!t||e.length!==t);n=!0);}catch(l){i=!0,o=l}finally{try{!n&&u["return"]&&u["return"]()}finally{if(i)throw o}}return e}throw new TypeError("Invalid attempt to destructure non-iterable instance")};!function(){angular.module("vorm").directive("vormSubmit",["$parse",function(r){return{require:["vormForm"],link:function(t,e,n,i){function o(){l(t,{$values:u.getValues()})}var a=_slicedToArray(i,1),u=a[0],l=void 0;l=r(n.vormSubmit),e.bind("submit",o)}}}])}();!function(){angular.module("vorm").provider("vormTemplateService",[function(){function e(e){m.model=_.mapValues(m.model,function(t,o){return e(t,o)})}function t(e){m.display=_.mapValues(m.display,function(t,o){return e(t,o)})}function o(e){var t=e(angular.element(n));t.attr("vorm-field",""),t.find("vorm-control").attr("limit","vormFieldConfig.getLimit()"),n=t[0].outerHTML}function l(e){var t=angular.element("<p></p>");t.append(e(angular.element(a))),a=t[0].innerHTML}function r(e,t,o){m.model[e]=t,o&&(m.display[e]=o)}var n=void 0,a=void 0,i={model:{},display:{}},m={model:{},display:{"null":angular.element("<span>{{vormDisplay.getViewValue()}}</span>")}},u={};return n='<div ng-class="vormField.getClassObj()"><vorm-label></vorm-label><vorm-replace></vorm-replace></div>',a='<vorm-control-list><vorm-control ng-repeat="delegate in vormControlList.getDelegates()" delegate="delegate"><vorm-edit ng-show="vormControl.getDisplayMode()===\'edit\'"><vorm-control-replace></vorm-control-replace><button class="vorm-control-clear-button" type="button" ng-click="vormControlList.handleClearClick(delegate)" ng-show="vormControlList.isClearButtonVisible()">x</button></vorm-edit><vorm-display ng-show="vormControl.getDisplayMode()===\'display\'"></vorm-display></vorm-control><vorm-delegate-button></vorm-delegate-button></vorm-control-list>',o(function(){return angular.element(n)}),l(function(){return angular.element(a)}),{$get:["$compile",function(e){function t(o,l,r){var n=void 0,a=i[o];if(n=r?e(r):a[l],n||"display"!==o||(n=t(o,null)),!n)throw new Error(""+_.capitalize(o)+" template for "+l+" not found");return n}return u.getDefaultTemplate=function(){return n},u.getDefaultControlTemplate=function(){return a},u.getModelCompiler=function(e,o){return t("model",e,o)},u.getDisplayCompiler=function(e,o){return t("display",e,o)},i.model=_.mapValues(m.model,function(t){var o=void 0;return _.some(t,function(e){var t=void 0;return e.hasAttribute("ng-model")?o=angular.element(e):(t=e.querySelector("[ng-model]"))&&(o=angular.element(t)),!!o}),o||(o=t),o.attr("ng-model","delegate.value"),o.attr("name","{{delegate.getName()}}"),o.attr("ng-required","vormControl.isRequired()"),e(t)}),i.display=_.mapValues(m.display,function(t){return e(t)}),u}],modifyModelTemplates:e,modifyDisplayTemplates:t,modifyControlTemplate:l,modifyTemplate:o,registerType:r}}])}();!function(){angular.module("vorm").config(["vormTemplateServiceProvider",function(e){var r=_("date datetime datetime-local email month number password search tel text time url week checkbox".split(" ")).zipObject().mapValues(function(e,r){var t=_.includes("text search tel url email number password".split(" "),r)?"placeholder=\"{{vormControl.invokeData('placeholder')}}\"":"",l='<input type="'+r+'" '+t+" ng-model/>";return"checkbox"===r&&(l='<label for="{{vormControl.getInputId()}}">'+l+'{{vormControl.invokeData("checkboxLabel")}}</label>'),l}).value();for(var t in r)e.registerType(t,angular.element(r[t]))}])}();!function(){angular.module("vorm").config(["vormTemplateServiceProvider",function(e){var o=angular.element('<div class="vorm-radio-group"><label ng-repeat="option in vormControl.getOptions()"><input type="radio" ng-model name="{{::vormField.getName()}}" value="{{::option.value}}"/>{{::option.label}}</label></div>');e.registerType("radio",o)}])}();!function(){angular.module("vorm").config(["vormTemplateServiceProvider",function(o){var e=angular.element('<select ng-options="option.value as option.label for option in vormControl.getOptions()"><option value="" ng-show="!!vormControl.invokeData(\'notSelectedLabel\')">{{vormControl.invokeData(\'notSelectedLabel\')}}</option></select>');o.registerType("select",e)}])}();!function(){angular.module("vorm").config(["vormTemplateServiceProvider",function(e){var r=angular.element("<textarea placeholder=\"{{vormControl.invokeData('placeholder')}}\"></textarea>");e.registerType("textarea",r)}])}();
//# sourceMappingURL=vorm.js.map